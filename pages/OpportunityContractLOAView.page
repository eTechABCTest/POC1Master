<!-- 
    Description     :   VF page to CPQ opportunities New/Edit 
    
    Created By      :   Subhash Garhwal
    
    Created Date    :   06/08/2016
    
    Revision Logs   :   V_1.0 - Created - CR-20160414-9762
    
 -->
<apex:page standardController="Opportunity" id="pge" extensions="OppControllerExtension">

    <!-- Header -->
    <apex:sectionHeader title="Opportunity" subtitle="{!Opportunity.Name}"/>
    
    <!-- Chatter Feed-->
    <chatter:feedWithFollowers entityId="{!Opportunity.Id}"/>
    
    
    <div class="RLPanelShadow">
        <div class="RLPanel" id="RLPanel" onblur="sfdcPage.relatedListPanel.hideRLDelayed(null, 100)" onfocus="sfdcPage.relatedListPanel.showRL()" onmouseout="sfdcPage.relatedListPanel.hideRLDelayed(null, 100)" onmouseover="sfdcPage.relatedListPanel.showRL()">
            <iframe frameborder="0" id="RLPanelFrame" name="RLPanelFrame" src="/emptyHtmlDoc.html" title="Hidden Frame - Ignore">
            <div class="{!IF(hideProgramOppNewButton, 'programOppStop','')}"></div> 
            </iframe>
        </div>
    </div><div class="listHoverLinks"><span class="invisibleMinHeight">|</span></div>
    <script type="text/javascript">
        try { sfdcPage.registerRelatedListPanel('RLPanel',false);} catch(e) {}
    </script>
    
    
    <div style="display:none;"><apex:include pageName="Opp_Ext_Invoke_OCR_Onview_Trigger"/></div>
    <script src="/soap/ajax/35.0/connection.js" type="text/javascript"></script>
    <script src="/soap/ajax/35.0/apex.js" type="text/javascript"></script>
    <script src="https://code.jquery.com/jquery-1.11.3.js"></script>
    
    <!-- Style -->
    <style>
        .programOppStop input[name = "new_program_opportunity"]{
            display:none;
        }
    </style>
    
    <!-- Script to populate Probability according to stage -->
    <script>
        
        sforce.connection.sessionId = "{!$Api.Session_ID}";
        
        //Function
        function validateProbability(elem) {
        
            //Get value of Stage
            var stageValue = elem.value;
            
            //Check for value
            if(stageValue != null && stageValue != '' && stageValue != undefined) {
                
                var qr = sforce.connection.query("Select DefaultProbability From OpportunityStage where MasterLabel = '" + stageValue + "'") ; 
                records = qr.getArray("records");
                
                //Get element by class Name
                document.getElementsByClassName("probabilityClass")[0].value = records[0].DefaultProbability; 
            } else
                document.getElementsByClassName("probabilityClass")[0].value = '';
        }
        
        $(document).ready(function() {
            
            $(".listHoverLinks").hover(function() {
                
                if({!hideProgramOppNewButton} == true) {
                    
                    var programOppsButton = document.getElementsByName('new_program_opportunity');
                    
                    if(programOppsButton != undefined) {
                        
                        for(var i = 0; i <programOppsButton.length; i++)
                            programOppsButton[i].style.display = 'none';
                    }
                }
            }); 
        });
        
    </script>
    
    <!--Form -->
    <apex:form id="frm">
            
        <!--Page Block -->
        <apex:pageBlock id="pB" title="Opportunity Detail" mode="maindetail">
            
            <!-- Page Messages -->
            <apex:pageMessages id="msg"/>
            
            <!-- Page Block buttons -->
            <apex:pageBlockButtons id="btn">
                <apex:commandButton action="{!doSave}" value="Save" style="display:none;" id="saveButton"/>
                <apex:commandButton action="{!cancel}" value="Cancel" style="display:none;" id="cancelButton"/>
                <apex:commandButton action="{!edit}" value="Edit" id="editButton"/>
                <apex:commandButton action="{!delete}" value="Delete" id="deleteButton"/>
                <apex:commandButton onclick="window.open('{!URLFOR($Action.Opportunity.SendToEchoSign_NewBusiness, Opportunity.Id,null, true)}', '', 'width=600,height=500'); return false;" id="sendTOSignature" value="Send for Signature" style="display:{!IF(OR(Opportunity.StageName = 'On Deck', Opportunity.StageName = 'Closed Won', Opportunity.StageName = 'Closed Lost'), 'none', 'inline-block')}"/>
                <apex:commandButton action="{!URLFOR('/apex/ReferenceRequest_New', Opportunity.Id,[sourceId=Opportunity.Id, retURL=$CurrentPage.URL], true)}" id="requestReference" value="Request a Reference" rendered="{!IF(OR(Opportunity.StageName = 'Closed Won', Opportunity.StageName = 'Closed Lost'), 'false', 'true')}"/>
            </apex:pageBlockButtons>
            
            <!-- Information section start -->
            
            <!-- Information Section (Open Opps)-->
            <apex:pageBlockSection title="Opportunity Information" columns="2" id="openOPPInfoPBS" rendered="{!IF(contains(flowControl, 'V2_INFO_Open'), 'true', 'false')}" >
                
                <!-- Section Items to display fields -->
                <apex:pageBlockSectionItem helpText="{!$ObjectType.Opportunity.fields.OwnerId.inlineHelpText}">
                    <apex:outputLabel value="Opportunity Owner"/>
                    <apex:outputField value="{!Opportunity.OwnerId}">
                        <apex:inlineEditSupport event="ondblclick" showOnEdit="saveButton,cancelButton" hideOnEdit="editButton,deleteButton,requestReference,sendTOSignature" />
                    </apex:outputField>
                </apex:pageBlockSectionItem>
                
                <apex:pageBlockSectionItem helpText="{!$ObjectType.Opportunity.fields.RecordTypeId.inlineHelpText}">
                    <apex:outputLabel value="Opportunity Record Type"/>
                    <apex:outputField value="{!Opportunity.RecordTypeId}" />
                </apex:pageBlockSectionItem>
                
                <apex:pageBlockSectionItem helpText="{!$ObjectType.Opportunity.fields.Name.inlineHelpText}">
                    <apex:outputLabel value="Opportunity Name"/>
                    <apex:outputField value="{!Opportunity.Name}">
                        <apex:inlineEditSupport event="ondblClick" showOnEdit="saveButton,cancelButton" hideOnEdit="editButton,deleteButton,requestReference,sendTOSignature" />
                    </apex:outputField>
                </apex:pageBlockSectionItem>
                
                <apex:pageBlockSectionItem helpText="{!$ObjectType.Opportunity.fields.CloseDate.inlineHelpText}">
                    <apex:outputLabel value="{!$ObjectType.Opportunity.fields.CloseDate.Label}"/>
                    <apex:outputField value="{!Opportunity.CloseDate}">
                        <apex:inlineEditSupport event="ondblClick" showOnEdit="saveButton,cancelButton" hideOnEdit="editButton,deleteButton,requestReference,sendTOSignature" />
                    </apex:outputField>
                </apex:pageBlockSectionItem>
                
                <apex:pageBlockSectionItem helpText="{!$ObjectType.Opportunity.fields.Opportunity_Nickname__c.inlineHelpText}">
                    <apex:outputLabel value="{!$ObjectType.Opportunity.fields.Opportunity_Nickname__c.Label}"/>
                    <apex:outputField value="{!Opportunity.Opportunity_Nickname__c}">
                        <apex:inlineEditSupport event="ondblClick" showOnEdit="saveButton,cancelButton" hideOnEdit="editButton,deleteButton,requestReference,sendTOSignature" />
                    </apex:outputField>
                </apex:pageBlockSectionItem>
                
                <apex:pageBlockSectionItem helpText="{!$ObjectType.Opportunity.fields.StageName.inlineHelpText}">
                    <apex:outputLabel value="{!$ObjectType.Opportunity.fields.StageName.Label}"/>
                    <apex:outputField value="{!Opportunity.StageName}"/>
                </apex:pageBlockSectionItem>
                
                <apex:pageBlockSectionItem helpText="{!$ObjectType.Opportunity.fields.AccountId.inlineHelpText}">
                    <apex:outputLabel value="{!$ObjectType.Opportunity.fields.AccountId.Label}"/>
                    <apex:outputField value="{!Opportunity.AccountId}">
                        <apex:inlineEditSupport event="ondblClick" showOnEdit="saveButton,cancelButton" hideOnEdit="editButton,deleteButton,requestReference,sendTOSignature" />
                    </apex:outputField>
                </apex:pageBlockSectionItem>
                
                <apex:pageBlockSectionItem helpText="{!$ObjectType.Opportunity.fields.Amount.inlineHelpText}">
                    <apex:outputLabel value="{!$ObjectType.Opportunity.fields.Amount.Label}"/>
                    <apex:outputField value="{!Opportunity.Amount}">
                        <apex:inlineEditSupport event="ondblClick" showOnEdit="saveButton,cancelButton" hideOnEdit="editButton,deleteButton,requestReference,sendTOSignature" />
                    </apex:outputField>
                </apex:pageBlockSectionItem>
                
                <apex:pageBlockSectionItem helpText="{!$ObjectType.Opportunity.fields.Institution_Restriction_Status__c.inlineHelpText}">
                    <apex:outputLabel value="{!$ObjectType.Opportunity.fields.Institution_Restriction_Status__c.Label}"/>
                    <apex:outputField value="{!Opportunity.Institution_Restriction_Status__c}"/>
                </apex:pageBlockSectionItem>
                
                <apex:pageBlockSectionItem helpText="{!$ObjectType.Opportunity.fields.Probability.inlineHelpText}">
                    <apex:outputLabel value="{!$ObjectType.Opportunity.fields.Probability.Label}"/>
                    <apex:outputField value="{!Opportunity.Probability}" styleClass="probabilityClass">
                        <apex:inlineEditSupport event="ondblClick" showOnEdit="saveButton,cancelButton" hideOnEdit="editButton,deleteButton,requestReference,sendTOSignature" />
                    </apex:outputField>
                </apex:pageBlockSectionItem>
                
                <apex:pageBlockSectionItem helpText="{!$ObjectType.Opportunity.fields.Main_Contact__c.inlineHelpText}">
                    <apex:outputLabel value="{!$ObjectType.Opportunity.fields.Main_Contact__c.Label}"/>
                    <apex:outputField value="{!Opportunity.Main_Contact__c}" />
                </apex:pageBlockSectionItem>
                
                <apex:pageBlockSectionItem helpText="{!$ObjectType.Opportunity.fields.Institution_Solution_Flag__c.inlineHelpText}">
                    <apex:outputLabel value="{!$ObjectType.Opportunity.fields.Institution_Solution_Flag__c.Label}"/>
                    <apex:outputField value="{!Opportunity.Institution_Solution_Flag__c}"/>
                </apex:pageBlockSectionItem>
                
                <!-- Subhash Garhwal - 07/12/2016 - Commented QA #61 -->
                <!-- 
                <apex:pageBlockSectionItem helpText="{!$ObjectType.Opportunity.fields.Size_of_Organization__c.inlineHelpText}">
                    <apex:outputLabel value="{!$ObjectType.Opportunity.fields.Size_of_Organization__c.Label}"/>
                    <apex:outputField value="{!Opportunity.Size_of_Organization__c}">
                        <apex:inlineEditSupport event="ondblClick" showOnEdit="saveButton,cancelButton" hideOnEdit="editButton,deleteButton,requestReference,sendTOSignature" />
                    </apex:outputField>
                </apex:pageBlockSectionItem>
                 -->
                 
                <!-- Subhash Garhwal - 07/12/2016 - Added QA #61 -->
                <apex:pageBlockSectionItem />
                
                <apex:pageBlockSectionItem helpText="{!$ObjectType.Opportunity.fields.Solutions_Stage__c.inlineHelpText}">
                    <apex:outputLabel value="{!$ObjectType.Opportunity.fields.Solutions_Stage__c.Label}"/>
                    <apex:outputField value="{!Opportunity.Solutions_Stage__c}">
                        <apex:inlineEditSupport event="ondblClick" showOnEdit="saveButton,cancelButton" hideOnEdit="editButton,deleteButton,requestReference,sendTOSignature" />
                    </apex:outputField>
                </apex:pageBlockSectionItem>
                
                <!--apex:pageBlockSectionItem helpText="{!$ObjectType.Opportunity.fields.New_Business_Group__c.inlineHelpText}">
                    <apex:outputLabel value="{!$ObjectType.Opportunity.fields.New_Business_Group__c.Label}"/>
                    <apex:outputField value="{!Opportunity.New_Business_Group__c}"/>
                </apex:pageBlockSectionItem-->
                
                <apex:pageBlockSectionItem />
                
                <apex:pageBlockSectionItem helpText="{!$ObjectType.Opportunity.fields.Pipeline_Freshness__c.inlineHelpText}">
                    <apex:outputLabel value="{!$ObjectType.Opportunity.fields.Pipeline_Freshness__c.Label}"/>
                    <apex:outputField value="{!Opportunity.Pipeline_Freshness__c}"/>
                </apex:pageBlockSectionItem>
                
                <!--apex:pageBlockSectionItem helpText="{!$ObjectType.Opportunity.fields.New_Business_Marketer__c.inlineHelpText}">
                    <apex:outputLabel value="{!$ObjectType.Opportunity.fields.New_Business_Marketer__c.Label}"/>
                    <apex:outputField value="{!Opportunity.New_Business_Marketer__c}"/>
                </apex:pageBlockSectionItem-->
                
                <!--apex:pageBlockSectionItem helpText="{!$ObjectType.Opportunity.fields.Account_EA_AE__c.inlineHelpText}">
                    <apex:outputLabel value="{!$ObjectType.Opportunity.fields.Account_EA_AE__c.Label}"/>
                    <apex:outputField value="{!Opportunity.Account_EA_AE__c}"/>
                </apex:pageBlockSectionItem-->
            </apex:pageBlockSection>
            
            <!-- Information Section (Closed Opps)-->
            <apex:pageBlockSection title="Opportunity Information" columns="2" id="closedOPPInfoPBS" rendered="{!IF(contains(flowControl, 'V3_INFO_Closed'), 'true', 'false')}" >
                
                <!-- Section Items to display fields -->
                <apex:pageBlockSectionItem helpText="{!$ObjectType.Opportunity.fields.OwnerId.inlineHelpText}">
                    <apex:outputLabel value="Opportunity Owner"/>
                    <apex:outputField value="{!Opportunity.OwnerId}">
                        <apex:inlineEditSupport event="ondblClick" showOnEdit="saveButton,cancelButton" hideOnEdit="editButton,deleteButton,requestReference,sendTOSignature" />
                    </apex:outputField>
                </apex:pageBlockSectionItem>
                
                <apex:pageBlockSectionItem helpText="{!$ObjectType.Opportunity.fields.RecordTypeId.inlineHelpText}">
                    <apex:outputLabel value="Opportunity Record Type"/>
                    <apex:outputField value="{!Opportunity.RecordTypeId}" />
                </apex:pageBlockSectionItem>
                
                <apex:pageBlockSectionItem helpText="{!$ObjectType.Opportunity.fields.Name.inlineHelpText}">
                    <apex:outputLabel value="Opportunity Name"/>
                    <apex:outputField value="{!Opportunity.Name}">
                        <apex:inlineEditSupport event="ondblclick" showOnEdit="saveButton,cancelButton" hideOnEdit="editButton,deleteButton,requestReference,sendTOSignature" />
                    </apex:outputField>
                </apex:pageBlockSectionItem>
                
                <apex:pageBlockSectionItem helpText="{!$ObjectType.Opportunity.fields.CloseDate.inlineHelpText}">
                    <apex:outputLabel value="{!$ObjectType.Opportunity.fields.CloseDate.Label}"/>
                    <apex:outputField value="{!Opportunity.CloseDate}"/>
                </apex:pageBlockSectionItem>
                
                <apex:pageBlockSectionItem helpText="{!$ObjectType.Opportunity.fields.Opportunity_Nickname__c.inlineHelpText}">
                    <apex:outputLabel value="{!$ObjectType.Opportunity.fields.Opportunity_Nickname__c.Label}"/>
                    <apex:outputField value="{!Opportunity.Opportunity_Nickname__c}"/>
                </apex:pageBlockSectionItem>
                
                <apex:pageBlockSectionItem helpText="{!$ObjectType.Opportunity.fields.StageName.inlineHelpText}">
                    <apex:outputLabel value="{!$ObjectType.Opportunity.fields.StageName.Label}"/>
                    <apex:outputField value="{!Opportunity.StageName}"/>
                </apex:pageBlockSectionItem>
                
                <apex:pageBlockSectionItem helpText="{!$ObjectType.Opportunity.fields.AccountId.inlineHelpText}">
                    <apex:outputLabel value="{!$ObjectType.Opportunity.fields.AccountId.Label}"/>
                    <apex:outputField value="{!Opportunity.AccountId}">
                        <apex:inlineEditSupport event="ondblClick" showOnEdit="saveButton,cancelButton" hideOnEdit="editButton,deleteButton,requestReference,sendTOSignature" />
                    </apex:outputField>
                </apex:pageBlockSectionItem>
                
                <apex:pageBlockSectionItem helpText="{!$ObjectType.Opportunity.fields.Amount.inlineHelpText}">
                    <apex:outputLabel value="{!$ObjectType.Opportunity.fields.Amount.Label}"/>
                    <apex:outputField value="{!Opportunity.Amount}"/>
                </apex:pageBlockSectionItem>
                
                <apex:pageBlockSectionItem helpText="{!$ObjectType.Opportunity.fields.Institution_Restriction_Status__c.inlineHelpText}">
                    <apex:outputLabel value="{!$ObjectType.Opportunity.fields.Institution_Restriction_Status__c.Label}"/>
                    <apex:outputField value="{!Opportunity.Institution_Restriction_Status__c}"/>
                </apex:pageBlockSectionItem>
                <apex:pageBlockSectionItem />
                <apex:pageBlockSectionItem helpText="{!$ObjectType.Opportunity.fields.Main_Contact__c.inlineHelpText}">
                    <apex:outputLabel value="{!$ObjectType.Opportunity.fields.Main_Contact__c.Label}"/>
                    <apex:outputField value="{!Opportunity.Main_Contact__c}"/>
                </apex:pageBlockSectionItem>
                
                <apex:pageBlockSectionItem helpText="{!$ObjectType.Opportunity.fields.Institution_Solution_Flag__c.inlineHelpText}">
                    <apex:outputLabel value="{!$ObjectType.Opportunity.fields.Institution_Solution_Flag__c.Label}"/>
                    <apex:outputField value="{!Opportunity.Institution_Solution_Flag__c}"/>
                </apex:pageBlockSectionItem>
                
                <!-- Subhash Garhwal - 07/12/2016 - Commented QA #61 -->
                <!-- <apex:pageBlockSectionItem helpText="{!$ObjectType.Opportunity.fields.Size_of_Organization__c.inlineHelpText}">
                    <apex:outputLabel value="{!$ObjectType.Opportunity.fields.Size_of_Organization__c.Label}"/>
                    <apex:outputField value="{!Opportunity.Size_of_Organization__c}"/>
                </apex:pageBlockSectionItem>
                -->
                
                <!-- Subhash Garhwal - 07/12/2016 - Added QA #61 -->
                <apex:pageBlockSectionItem />
                
                <apex:pageBlockSectionItem helpText="{!$ObjectType.Opportunity.fields.Solutions_Stage__c.inlineHelpText}">
                    <apex:outputLabel value="{!$ObjectType.Opportunity.fields.Solutions_Stage__c.Label}"/>
                    <apex:outputField value="{!Opportunity.Solutions_Stage__c}"/>
                </apex:pageBlockSectionItem>
                
                <!--apex:pageBlockSectionItem helpText="{!$ObjectType.Opportunity.fields.New_Business_Group__c.inlineHelpText}">
                    <apex:outputLabel value="{!$ObjectType.Opportunity.fields.New_Business_Group__c.Label}"/>
                    <apex:outputField value="{!Opportunity.New_Business_Group__c}"/>
                </apex:pageBlockSectionItem-->
                
                <!--apex:pageBlockSectionItem helpText="{!$ObjectType.Opportunity.fields.Pipeline_Freshness__c.inlineHelpText}">
                    <apex:outputLabel value="{!$ObjectType.Opportunity.fields.Pipeline_Freshness__c.Label}"/>
                    <apex:outputField value="{!Opportunity.Pipeline_Freshness__c}"/>
                </apex:pageBlockSectionItem-->
                
                <!--apex:pageBlockSectionItem helpText="{!$ObjectType.Opportunity.fields.New_Business_Marketer__c.inlineHelpText}">
                    <apex:outputLabel value="{!$ObjectType.Opportunity.fields.New_Business_Marketer__c.Label}"/>
                    <apex:outputField value="{!Opportunity.New_Business_Marketer__c}"/>
                </apex:pageBlockSectionItem-->
                
                <!--apex:pageBlockSectionItem helpText="{!$ObjectType.Opportunity.fields.Account_EA_AE__c.inlineHelpText}">
                    <apex:outputLabel value="{!$ObjectType.Opportunity.fields.Account_EA_AE__c.Label}"/>
                    <apex:outputField value="{!Opportunity.Account_EA_AE__c}"/>
                </apex:pageBlockSectionItem-->
            </apex:pageBlockSection>
            <!-- Information section End -->
            
            <!-- Result section (Open/Advance/Closed Opps)-->
            <apex:pageBlockSection title="Result" columns="2" id="openClosedOPPResultPBS" rendered="{!IF(contains(flowControl, 'V2_Result_Open'), 'true', 'false')}">
                
                <apex:pageBlockSectionItem helpText="{!$ObjectType.Opportunity.fields.NBB__c.inlineHelpText}">
                    <apex:outputLabel value="{!$ObjectType.Opportunity.fields.NBB__c.Label}"/>
                    <apex:outputField value="{!Opportunity.NBB__c}">
                        <apex:inlineEditSupport event="ondblClick" showOnEdit="saveButton,cancelButton" hideOnEdit="editButton,deleteButton,requestReference,sendTOSignature" />
                    </apex:outputField>
                </apex:pageBlockSectionItem>
                
                <apex:pageBlockSectionItem helpText="{!$ObjectType.Opportunity.fields.Signed_Opportunity_Contract__c.inlineHelpText}">
                    <apex:outputLabel value="{!$ObjectType.Opportunity.fields.Signed_Opportunity_Contract__c.Label}"/>
                    <apex:outputField value="{!Opportunity.Signed_Opportunity_Contract__c}">
                        <apex:inlineEditSupport event="ondblClick" showOnEdit="saveButton,cancelButton" hideOnEdit="editButton,deleteButton,requestReference,sendTOSignature" />
                    </apex:outputField>
                </apex:pageBlockSectionItem>
                
                <apex:pageBlockSectionItem helpText="{!$ObjectType.Opportunity.fields.NBB_Units__c.inlineHelpText}">
                    <apex:outputLabel value="{!$ObjectType.Opportunity.fields.NBB_Units__c.Label}"/>
                    <apex:outputField value="{!Opportunity.NBB_Units__c}">
                        <apex:inlineEditSupport event="ondblClick" showOnEdit="saveButton,cancelButton" hideOnEdit="editButton,deleteButton,requestReference,sendTOSignature" />
                    </apex:outputField>
                </apex:pageBlockSectionItem>
                
                <apex:pageBlockSectionItem helpText="{!$ObjectType.Opportunity.fields.Reason_Won__c.inlineHelpText}" rendered="{!IF(contains(flowControl, 'V3_MF_Closed'), 'true','false')}">
                    <apex:outputLabel value="{!$ObjectType.Opportunity.fields.Reason_Won__c.Label}"/>
                    <apex:outputField value="{!Opportunity.Reason_Won__c}">
                        <apex:inlineEditSupport event="ondblClick" showOnEdit="saveButton,cancelButton" hideOnEdit="editButton,deleteButton,requestReference,sendTOSignature" />
                    </apex:outputField>
                </apex:pageBlockSectionItem>
                
                <apex:pageBlockSectionItem rendered="{!IF(contains(flowControl, 'V3_MF_Closed'), 'false','true')}" />
                
                <apex:pageBlockSectionItem helpText="{!$ObjectType.Opportunity.fields.Closed_Opp_Comments__c.inlineHelpText}">
                    <apex:outputLabel value="{!$ObjectType.Opportunity.fields.Closed_Opp_Comments__c.Label}"/>
                    <apex:outputField value="{!Opportunity.Closed_Opp_Comments__c}">
                        <apex:inlineEditSupport event="ondblClick" showOnEdit="saveButton,cancelButton" hideOnEdit="editButton,deleteButton,requestReference,sendTOSignature" />
                    </apex:outputField>
                </apex:pageBlockSectionItem>
                
                <apex:pageBlockSectionItem helpText="{!$ObjectType.Opportunity.fields.Primary_Reason_Lost__c.inlineHelpText}" rendered="{!IF(contains(flowControl, 'V3_MF_Closed'), 'true','false')}">
                    <apex:outputLabel value="{!$ObjectType.Opportunity.fields.Primary_Reason_Lost__c.Label}"/>
                    <apex:outputField value="{!Opportunity.Primary_Reason_Lost__c}">
                        <apex:inlineEditSupport event="ondblClick" showOnEdit="saveButton,cancelButton" hideOnEdit="editButton,deleteButton,requestReference,sendTOSignature" />
                    </apex:outputField>
                </apex:pageBlockSectionItem>
                    
            </apex:pageBlockSection>
            <!-- Result section (Open/Advance/Closed Opps) End-->
            
            <!-- Next Step section-->
            <apex:pageBlockSection title="Next Step" columns="1" id="oPPNSPBS">
                
                <apex:pageBlockSectionItem helpText="{!$ObjectType.Opportunity.fields.Next_Step_Date__c.inlineHelpText}">
                    <apex:outputLabel value="{!$ObjectType.Opportunity.fields.Next_Step_Date__c.Label}"/>
                    <apex:outputField value="{!Opportunity.Next_Step_Date__c}" style="width: 800px;height: 75px;">
                        <apex:inlineEditSupport event="ondblClick" showOnEdit="saveButton,cancelButton" hideOnEdit="editButton,deleteButton,requestReference,sendTOSignature" />
                    </apex:outputField>
                </apex:pageBlockSectionItem>
                
                <apex:pageBlockSectionItem helpText="{!$ObjectType.Opportunity.fields.Next_Steps_Text__c.inlineHelpText}">
                    <apex:outputLabel value="{!$ObjectType.Opportunity.fields.Next_Steps_Text__c.Label}"/>
                    <apex:outputField value="{!Opportunity.Next_Steps_Text__c}" style="width: 800px;height: 75px;">
                        <apex:inlineEditSupport event="ondblClick" showOnEdit="saveButton,cancelButton" hideOnEdit="editButton,deleteButton,requestReference,sendTOSignature" />
                    </apex:outputField>
                </apex:pageBlockSectionItem>
                
                <apex:pageBlockSectionItem helpText="{!$ObjectType.Opportunity.fields.Description.inlineHelpText}">
                    <apex:outputLabel value="{!$ObjectType.Opportunity.fields.Description.Label}"/>
                    <apex:outputField value="{!Opportunity.Description}">
                        <apex:inlineEditSupport event="ondblClick" showOnEdit="saveButton,cancelButton" hideOnEdit="editButton,deleteButton,requestReference,sendTOSignature" />
                    </apex:outputField>
                </apex:pageBlockSectionItem>
            </apex:pageBlockSection>
            <!-- Next Step section End-->
            
            <!-- Manager Forecast section (Open/Advance Opps)-->
            <apex:pageBlockSection title="Manager Forecast" columns="2" id="openOPPMFPBS" rendered="{!IF(contains(flowControl, 'V2_MF_Open'), 'true', 'false')}">
                
                <apex:pageBlockSectionItem helpText="{!$ObjectType.Opportunity.fields.Territory_Month_80_50__c.inlineHelpText}">
                    <apex:outputLabel value="{!$ObjectType.Opportunity.fields.Territory_Month_80_50__c.Label}"/>
                    <apex:outputField value="{!Opportunity.Territory_Month_80_50__c}">
                        <apex:inlineEditSupport event="ondblClick" showOnEdit="saveButton,cancelButton" hideOnEdit="editButton,deleteButton,requestReference,sendTOSignature" />
                    </apex:outputField>
                </apex:pageBlockSectionItem>
                
                <apex:pageBlockSectionItem helpText="{!$ObjectType.Opportunity.fields.Territory_Ever_80_50__c.inlineHelpText}">
                    <apex:outputLabel value="{!$ObjectType.Opportunity.fields.Territory_Ever_80_50__c.Label}"/>
                    <apex:outputField value="{!Opportunity.Territory_Ever_80_50__c}">
                        <apex:inlineEditSupport event="ondblClick" showOnEdit="saveButton,cancelButton" hideOnEdit="editButton,deleteButton,requestReference,sendTOSignature" />
                    </apex:outputField>
                </apex:pageBlockSectionItem>
            </apex:pageBlockSection>
            <!-- Manager Forecast section (Open/Advance Opps) End-->
            
            <!-- Manager Forecast section (Closed Opps)-->
            <apex:pageBlockSection title="Manager Forecast" columns="2" id="closedOPPMFPBS" rendered="{!IF(contains(flowControl, 'V3_MF_Closed'), 'true', 'false')}">
                
                <apex:pageBlockSectionItem helpText="{!$ObjectType.Opportunity.fields.Territory_Month_80_50__c.inlineHelpText}">
                    <apex:outputLabel value="{!$ObjectType.Opportunity.fields.Territory_Month_80_50__c.Label}"/>
                    <apex:outputField value="{!Opportunity.Territory_Month_80_50__c}"/>
                </apex:pageBlockSectionItem>
                
                <apex:pageBlockSectionItem helpText="{!$ObjectType.Opportunity.fields.Territory_Ever_80_50__c.inlineHelpText}">
                    <apex:outputLabel value="{!$ObjectType.Opportunity.fields.Territory_Ever_80_50__c.Label}"/>
                    <apex:outputField value="{!Opportunity.Territory_Ever_80_50__c}"/>
                </apex:pageBlockSectionItem>
            </apex:pageBlockSection>
            <!-- Manager Forecast section (Closed Opps) End-->
            
            <!-- Pipeline section (Open Opps)-->
            <apex:pageBlockSection title="Pipeline" columns="2" id="openOPPPipelinePBS" rendered="{!IF(contains(flowControl, 'V2_Pipeline_Open'), 'true', 'false')}">
                
                <apex:pageBlockSectionItem helpText="{!$ObjectType.Opportunity.fields.of_ELs_Sent__c.inlineHelpText}">
                    <apex:outputLabel value="{!$ObjectType.Opportunity.fields.of_ELs_Sent__c.Label}"/>
                    <apex:outputField value="{!Opportunity.of_ELs_Sent__c}">
                        <apex:inlineEditSupport event="ondblClick" showOnEdit="saveButton,cancelButton" hideOnEdit="editButton,deleteButton,requestReference,sendTOSignature" />    
                    </apex:outputField>
                </apex:pageBlockSectionItem>
                
                <apex:pageBlockSectionItem />
                
                <apex:pageBlockSectionItem helpText="{!$ObjectType.Opportunity.fields.Does_this_require_board_approval__c.inlineHelpText}">
                    <apex:outputLabel value="{!$ObjectType.Opportunity.fields.Does_this_require_board_approval__c.Label}"/>
                    <apex:outputField value="{!Opportunity.Does_this_require_board_approval__c}">
                        <apex:inlineEditSupport event="ondblClick" showOnEdit="saveButton,cancelButton" hideOnEdit="editButton,deleteButton,requestReference,sendTOSignature" />
                    </apex:outputField>
                </apex:pageBlockSectionItem>
                
                <apex:pageBlockSectionItem helpText="{!$ObjectType.Opportunity.fields.Has_budget_been_secured__c.inlineHelpText}">
                    <apex:outputLabel value="{!$ObjectType.Opportunity.fields.Has_budget_been_secured__c.Label}"/>
                    <apex:outputField value="{!Opportunity.Has_budget_been_secured__c}">
                        <apex:inlineEditSupport event="ondblClick" showOnEdit="saveButton,cancelButton" hideOnEdit="editButton,deleteButton,requestReference,sendTOSignature" />
                    </apex:outputField>
                </apex:pageBlockSectionItem>
                
                <apex:pageBlockSectionItem helpText="{!$ObjectType.Opportunity.fields.Does_This_Require_Committee__c.inlineHelpText}">
                    <apex:outputLabel value="{!$ObjectType.Opportunity.fields.Does_This_Require_Committee__c.Label}"/>
                    <apex:outputField value="{!Opportunity.Does_This_Require_Committee__c}">
                        <apex:inlineEditSupport event="ondblClick" showOnEdit="saveButton,cancelButton" hideOnEdit="editButton,deleteButton,requestReference,sendTOSignature" />
                    </apex:outputField>
                </apex:pageBlockSectionItem>
                
                <apex:pageBlockSectionItem helpText="{!$ObjectType.Opportunity.fields.Funding_Budget_Secured__c.inlineHelpText}">
                    <apex:outputLabel value="{!$ObjectType.Opportunity.fields.Funding_Budget_Secured__c.Label}"/>
                    <apex:outputField value="{!Opportunity.Funding_Budget_Secured__c}">
                        <apex:inlineEditSupport event="ondblClick" showOnEdit="saveButton,cancelButton" hideOnEdit="editButton,deleteButton,requestReference,sendTOSignature" />
                    </apex:outputField>
                </apex:pageBlockSectionItem>
                
                <apex:pageBlockSectionItem helpText="{!$ObjectType.Opportunity.fields.Negotiation_on_business_terms_complete__c.inlineHelpText}">
                    <apex:outputLabel value="{!$ObjectType.Opportunity.fields.Negotiation_on_business_terms_complete__c.Label}"/>
                    <apex:outputField value="{!Opportunity.Negotiation_on_business_terms_complete__c}">
                        <apex:inlineEditSupport event="ondblClick" showOnEdit="saveButton,cancelButton" hideOnEdit="editButton,deleteButton,requestReference,sendTOSignature" />
                    </apex:outputField>
                </apex:pageBlockSectionItem>
                
                <apex:pageBlockSectionItem helpText="{!$ObjectType.Opportunity.fields.Budget_Approval_Process_Clear__c.inlineHelpText}">
                    <apex:outputLabel value="{!$ObjectType.Opportunity.fields.Budget_Approval_Process_Clear__c.Label}"/>
                    <apex:outputField value="{!Opportunity.Budget_Approval_Process_Clear__c}">
                        <apex:inlineEditSupport event="ondblClick" showOnEdit="saveButton,cancelButton" hideOnEdit="editButton,deleteButton,requestReference,sendTOSignature" />
                    </apex:outputField>
                </apex:pageBlockSectionItem>
                
                <apex:pageBlockSectionItem helpText="{!$ObjectType.Opportunity.fields.Verbal_Commitment__c.inlineHelpText}">
                    <apex:outputLabel value="{!$ObjectType.Opportunity.fields.Verbal_Commitment__c.Label}"/>
                    <apex:outputField value="{!Opportunity.Verbal_Commitment__c}">
                        <apex:inlineEditSupport event="ondblClick" showOnEdit="saveButton,cancelButton" hideOnEdit="editButton,deleteButton,requestReference,sendTOSignature" />
                    </apex:outputField>
                </apex:pageBlockSectionItem>
            </apex:pageBlockSection>
            <!-- Pipeline section (Open Opps) End-->
            
            <!-- Pipeline section (Closed Opps)-->
            <apex:pageBlockSection title="Pipeline" columns="2" id="closedOPPPipelinePBS" rendered="{!IF(contains(flowControl, 'V3_Pipeline_Closed'), 'true', 'false')}">
                
                <apex:pageBlockSectionItem helpText="{!$ObjectType.Opportunity.fields.of_ELs_Sent__c.inlineHelpText}">
                    <apex:outputLabel value="{!$ObjectType.Opportunity.fields.of_ELs_Sent__c.Label}"/>
                    <apex:outputField value="{!Opportunity.of_ELs_Sent__c}"/>
                </apex:pageBlockSectionItem>
                
                <apex:pageBlockSectionItem />
                
                <apex:pageBlockSectionItem helpText="{!$ObjectType.Opportunity.fields.Does_this_require_board_approval__c.inlineHelpText}">
                    <apex:outputLabel value="{!$ObjectType.Opportunity.fields.Does_this_require_board_approval__c.Label}"/>
                    <apex:outputField value="{!Opportunity.Does_this_require_board_approval__c}"/>
                </apex:pageBlockSectionItem>
                
                <apex:pageBlockSectionItem helpText="{!$ObjectType.Opportunity.fields.Has_budget_been_secured__c.inlineHelpText}">
                    <apex:outputLabel value="{!$ObjectType.Opportunity.fields.Has_budget_been_secured__c.Label}"/>
                    <apex:outputField value="{!Opportunity.Has_budget_been_secured__c}"/>
                </apex:pageBlockSectionItem>
                
                <apex:pageBlockSectionItem helpText="{!$ObjectType.Opportunity.fields.Does_This_Require_Committee__c.inlineHelpText}">
                    <apex:outputLabel value="{!$ObjectType.Opportunity.fields.Does_This_Require_Committee__c.Label}"/>
                    <apex:outputField value="{!Opportunity.Does_This_Require_Committee__c}"/>
                </apex:pageBlockSectionItem>
                
                <apex:pageBlockSectionItem helpText="{!$ObjectType.Opportunity.fields.Funding_Budget_Secured__c.inlineHelpText}">
                    <apex:outputLabel value="{!$ObjectType.Opportunity.fields.Funding_Budget_Secured__c.Label}"/>
                    <apex:outputField value="{!Opportunity.Funding_Budget_Secured__c}"/>
                </apex:pageBlockSectionItem>
                
                <apex:pageBlockSectionItem helpText="{!$ObjectType.Opportunity.fields.Negotiation_on_business_terms_complete__c.inlineHelpText}">
                    <apex:outputLabel value="{!$ObjectType.Opportunity.fields.Negotiation_on_business_terms_complete__c.Label}"/>
                    <apex:outputField value="{!Opportunity.Negotiation_on_business_terms_complete__c}"/>
                </apex:pageBlockSectionItem>
                
                <apex:pageBlockSectionItem helpText="{!$ObjectType.Opportunity.fields.Budget_Approval_Process_Clear__c.inlineHelpText}">
                    <apex:outputLabel value="{!$ObjectType.Opportunity.fields.Budget_Approval_Process_Clear__c.Label}"/>
                    <apex:outputField value="{!Opportunity.Budget_Approval_Process_Clear__c}"/>
                </apex:pageBlockSectionItem>
                
                <apex:pageBlockSectionItem helpText="{!$ObjectType.Opportunity.fields.Verbal_Commitment__c.inlineHelpText}">
                    <apex:outputLabel value="{!$ObjectType.Opportunity.fields.Verbal_Commitment__c.Label}"/>
                    <apex:outputField value="{!Opportunity.Verbal_Commitment__c}"/>
                </apex:pageBlockSectionItem>
            </apex:pageBlockSection>
            <!-- Pipeline section (Closed Opps) End-->
            
            <!-- SteelBrick section (New/Open Opps)-->
            <apex:pageBlockSection title="SteelBrick" columns="2" id="openOPPSBPBS" rendered="{!IF(contains(flowControl, 'V1_2_SB_New'), 'true', 'false')}">
                
                <apex:pageBlockSectionItem />
                
                <apex:pageBlockSectionItem helpText="{!$ObjectType.Opportunity.fields.SBQQ__Renewal__c.inlineHelpText}">
                    <apex:outputLabel value="{!$ObjectType.Opportunity.fields.SBQQ__Renewal__c.Label}"/>
                    <apex:outputField value="{!Opportunity.SBQQ__Renewal__c}"/>
                </apex:pageBlockSectionItem>
                
                <apex:pageBlockSectionItem />
                
                <apex:pageBlockSectionItem helpText="{!$ObjectType.Opportunity.fields.SBQQ__RenewedContract__c.inlineHelpText}">
                    <apex:outputLabel value="{!$ObjectType.Opportunity.fields.SBQQ__RenewedContract__c.Label}"/>
                    <apex:outputField value="{!Opportunity.SBQQ__RenewedContract__c}"/>
                </apex:pageBlockSectionItem>
                
            </apex:pageBlockSection>
            <!-- SteelBrick section (new/open Opps) End-->
            
            <!-- SteelBrick section (closed Opps)-->
            <apex:pageBlockSection title="SteelBrick" columns="2" id="closedOPPSBPBS" rendered="{!IF(contains(flowControl, 'V2_3_SB_Open_Closed'), 'true', 'false')}">
                
                <apex:pageBlockSectionItem helpText="{!$ObjectType.Opportunity.fields.SBQQ__PrimaryQuote__c.inlineHelpText}">
                    <apex:outputLabel value="{!$ObjectType.Opportunity.fields.SBQQ__PrimaryQuote__c.Label}"/>
                    <apex:outputField value="{!Opportunity.SBQQ__PrimaryQuote__c}"/>
                </apex:pageBlockSectionItem>
                
                <apex:pageBlockSectionItem helpText="{!$ObjectType.Opportunity.fields.SBQQ__Contracted__c.inlineHelpText}">
                    <apex:outputLabel value="{!$ObjectType.Opportunity.fields.SBQQ__Contracted__c.Label}"/>
                    <apex:outputField value="{!Opportunity.SBQQ__Contracted__c}">
                        <apex:inlineEditSupport event="ondblClick" showOnEdit="saveButton,cancelButton" hideOnEdit="editButton,deleteButton,requestReference,sendTOSignature" />
                    </apex:outputField>
                </apex:pageBlockSectionItem>
                
                <apex:pageBlockSectionItem />
                
                <apex:pageBlockSectionItem helpText="{!$ObjectType.Opportunity.fields.SBQQ__Renewal__c.inlineHelpText}">
                    <apex:outputLabel value="{!$ObjectType.Opportunity.fields.SBQQ__Renewal__c.Label}"/>
                    <apex:outputField value="{!Opportunity.SBQQ__Renewal__c}"/>
                </apex:pageBlockSectionItem>
                
                <apex:pageBlockSectionItem helpText="{!$ObjectType.Opportunity.fields.SBQQ__QuotePricebookId__c.inlineHelpText}">
                    <apex:outputLabel value="{!$ObjectType.Opportunity.fields.SBQQ__QuotePricebookId__c.Label}"/>
                    <apex:outputField value="{!Opportunity.SBQQ__QuotePricebookId__c}"/>
                </apex:pageBlockSectionItem>
                
                <apex:pageBlockSectionItem helpText="{!$ObjectType.Opportunity.fields.SBQQ__RenewedContract__c.inlineHelpText}">
                    <apex:outputLabel value="{!$ObjectType.Opportunity.fields.SBQQ__RenewedContract__c.Label}"/>
                    <apex:outputField value="{!Opportunity.SBQQ__RenewedContract__c}"/>
                </apex:pageBlockSectionItem>
            </apex:pageBlockSection>
            <!-- SteelBrick section (Closed Opps) End-->
            
            <!-- Opportunity Stats section (open/closed Opps)-->
            <apex:pageBlockSection title="Opportunity Stats" columns="2" id="openclosedOPPOSPBS" rendered="{!IF(contains(flowControl, 'V2_OS_Open'), 'true', 'false')}">
                
                <apex:pageBlockSectionItem helpText="{!$ObjectType.Opportunity.fields.Before_Solution__c.inlineHelpText}">
                    <apex:outputLabel value="{!$ObjectType.Opportunity.fields.Before_Solution__c.Label}"/>
                    <apex:outputField value="{!Opportunity.Before_Solution__c}"/>
                </apex:pageBlockSectionItem>
                
                <apex:pageBlockSectionItem helpText="{!$ObjectType.Opportunity.fields.Prorated_Proposal_Value__c.inlineHelpText}">
                    <apex:outputLabel value="{!$ObjectType.Opportunity.fields.Prorated_Proposal_Value__c.Label}"/>
                    <apex:outputField value="{!Opportunity.Prorated_Proposal_Value__c}"/>
                </apex:pageBlockSectionItem>
                
                <apex:pageBlockSectionItem helpText="{!$ObjectType.Opportunity.fields.Date_First_Moved_to_Fast_Track__c.inlineHelpText}">
                    <apex:outputLabel value="{!$ObjectType.Opportunity.fields.Date_First_Moved_to_Fast_Track__c.Label}"/>
                    <apex:outputField value="{!Opportunity.Date_First_Moved_to_Fast_Track__c}"/>
                </apex:pageBlockSectionItem>
                
                <apex:pageBlockSectionItem helpText="{!$ObjectType.Opportunity.fields.Calculated_Close_Date__c.inlineHelpText}">
                    <apex:outputLabel value="{!$ObjectType.Opportunity.fields.Calculated_Close_Date__c.Label}"/>
                    <apex:outputField value="{!Opportunity.Calculated_Close_Date__c}"/>
                </apex:pageBlockSectionItem>
                
                <apex:pageBlockSectionItem helpText="{!$ObjectType.Opportunity.fields.Primary_Program_Opps__c.inlineHelpText}">
                    <apex:outputLabel value="{!$ObjectType.Opportunity.fields.Primary_Program_Opps__c.Label}"/>
                    <apex:outputField value="{!Opportunity.Primary_Program_Opps__c}"/>
                </apex:pageBlockSectionItem>
                
                <apex:pageBlockSectionItem helpText="{!$ObjectType.Opportunity.fields.Probability_Field_Update__c.inlineHelpText}">
                    <apex:outputLabel value="{!$ObjectType.Opportunity.fields.Probability_Field_Update__c.Label}"/>
                    <apex:outputField value="{!Opportunity.Probability_Field_Update__c}"/>
                </apex:pageBlockSectionItem>
                
                <apex:pageBlockSectionItem helpText="{!$ObjectType.Opportunity.fields.Total_Program_Opps__c.inlineHelpText}">
                    <apex:outputLabel value="{!$ObjectType.Opportunity.fields.Total_Program_Opps__c.Label}"/>
                    <apex:outputField value="{!Opportunity.Total_Program_Opps__c}"/>
                </apex:pageBlockSectionItem>
            </apex:pageBlockSection>
            <!-- Opportunity Stats section (Open/Closed Opps) End-->
            
            <!-- System Info section-->
            <apex:pageBlockSection title="System Information" columns="2" id="openclosedOPPSIPBS" rendered="{!IF(contains(flowControl, 'V2_3_SI_Open'), 'true', 'false')}">
                
                <apex:pageBlockSectionItem >
                    <apex:outputLabel value="Created By"/>
                    <apex:outputPanel >
                        <apex:outputField value="{!Opportunity.CreatedById}"/> &nbsp;
                        <apex:outputField value="{!Opportunity.CreatedDate}" />
                    </apex:outputPanel>
                </apex:pageBlockSectionItem>
                
                <apex:pageBlockSectionItem helpText="{!$ObjectType.Opportunity.fields.Counter_ID__c.inlineHelpText}">
                    <apex:outputLabel value="{!$ObjectType.Opportunity.fields.Counter_ID__c.Label}"/>
                    <apex:outputField value="{!Opportunity.Counter_ID__c}"/>
                </apex:pageBlockSectionItem>
                
                <apex:pageBlockSectionItem >
                    <apex:outputLabel value="Last Modified By"/>
                        <apex:outputPanel >
                        <apex:outputField value="{!Opportunity.LastModifiedById}"/> &nbsp;
                        <apex:outputField value="{!Opportunity.LastModifiedDate}"/> 
                    </apex:outputPanel>
                </apex:pageBlockSectionItem>
            </apex:pageBlockSection>
            <!-- System Info section End-->
        </apex:pageBlock>
    </apex:form>
    
    <!-- Related list section -->
    <apex:outputPanel rendered="{!IF(contains(flowControl, 'V1_2_SB_New') || contains(flowControl, 'V2_Pipeline_Open'), 'true', 'false')}">
        
        <!-- Div to hide/display Program Opp New button -->
        <div class="{!IF(hideProgramOppNewButton, 'programOppStop','')}">
            <apex:relatedList id="openProgramOppRList" rendered="{!$ObjectType.Opportunity.fields.Parent_Opportunity__c.accessible}" subject="{!Opportunity}" list="Opportunities__r" />
        </div>
        <apex:relatedList id="openQuoteRList" title="Proposals" rendered="{!$ObjectType.SBQQ__Quote__c.accessible}" subject="{!Opportunity}" list="SBQQ__Quotes2__r" />
        <apex:relatedList id="openIntegratedAccountRList" rendered="{!$ObjectType.Integrated_Account__c.accessible}" subject="{!Opportunity}" list="Integrated_Accounts__r" />
        <apex:relatedList id="openOppTeamMemRList" rendered="{!$ObjectType.OpportunityTeamMember.accessible}" subject="{!Opportunity}" list="OpportunityTeamMembers" />
        <apex:relatedList id="openOppContractRoles" rendered="{!$ObjectType.OpportunityContactRole.accessible}" subject="{!Opportunity}" list="OpportunityContactRoles" />
        <apex:relatedList id="openReferenceReq" rendered="{!$ObjectType.Reference_Request__c.accessible}" subject="{!Opportunity}" list="Reference_Requests__r" />
        <apex:relatedList id="openOppHistories" subject="{!Opportunity}" list="OpportunityHistories" />
        <apex:relatedList id="openAttachments" subject="{!Opportunity}" list="CombinedAttachments" />
        <apex:relatedList id="openTeamMembership" rendered="{!$ObjectType.Team_Membership__c.accessible}" subject="{!Opportunity}" list="Staff_Assignments__r" />
        
        <!-- Script to show related list hover on top of the page -->
        <script type="text/javascript">
            try {
                
                if({!$ObjectType.Opportunity.fields.Parent_Opportunity__c.accessible})
                    sfdcPage.registerRelatedList('pge:openProgramOppRList', '', '', false, '', '',false,false,true, '');
                
                if({!$ObjectType.SBQQ__Quote__c.accessible})
                    sfdcPage.registerRelatedList('pge:openQuoteRList', '', '', false, '', '',false,false,true, '');
                
                if({!$ObjectType.Integrated_Account__c.accessible})
                    sfdcPage.registerRelatedList('pge:openIntegratedAccountRList', '', '', false, '', '',false,false,true, '');
                
                if({!$ObjectType.OpportunityTeamMember.accessible})
                    sfdcPage.registerRelatedList('pge:openOppTeamMemRList', '', '', false, '', '',false,false,true, '');
                
                if({!$ObjectType.OpportunityContactRole.accessible})
                    sfdcPage.registerRelatedList('pge:openOppContractRoles', '', '', false, '', '',false,false,true, '');
                
                if({!$ObjectType.Reference_Request__c.accessible})
                    sfdcPage.registerRelatedList('pge:openReferenceReq', '', '', false, '', '',false,false,true, '');
                
                sfdcPage.registerRelatedList('pge:openOppHistories', '', '', false, '', '',false,false,true, '');
                
                sfdcPage.registerRelatedList('pge:openAttachments', '', '', false, '', '',false,false,true, '');
                
                if({!$ObjectType.Team_Membership__c.accessible})
                    sfdcPage.registerRelatedList('pge:openTeamMembership', '', '', false, '', '',false,false,true, '');
                     
            } catch (e) {}
        </script>
    </apex:outputPanel>
    
    <!-- Related list section -->
    <apex:outputPanel rendered="{!IF(contains(flowControl, 'V3_INFO_Closed'), 'true', 'false')}">
        
        <div class="{!IF(hideProgramOppNewButton, 'programOppStop','')}">
            <apex:relatedList id="closedProgramOppsRList" rendered="{!$ObjectType.Opportunity.fields.Parent_Opportunity__c.accessible}" subject="{!Opportunity}" list="Opportunities__r" />
        </div>
        <apex:relatedList id="closedQuoteRList" title="Proposal" rendered="{!$ObjectType.SBQQ__Quote__c.accessible}" subject="{!Opportunity}" list="SBQQ__Quotes2__r" />
        <apex:relatedList id="closedContractRList" rendered="{!$ObjectType.Contract.accessible}" subject="{!Opportunity}" list="SBQQ__Contracts__r"/>
        <apex:relatedList id="closedIntegratedAccountRList" rendered="{!$ObjectType.Integrated_Account__c.accessible}" subject="{!Opportunity}" list="Integrated_Accounts__r" />
        <apex:relatedList id="closedSubscriptionRList" rendered="{!$ObjectType.SBQQ__Subscription__c.accessible}" subject="{!Opportunity}" list="Subscriptions__r" />
        <apex:relatedList id="closedOppTeamMemRList" rendered="{!$ObjectType.OpportunityTeamMember.accessible}" subject="{!Opportunity}" list="OpportunityTeamMembers" />
        <apex:relatedList id="closedOppContractRoles" rendered="{!$ObjectType.OpportunityContactRole.accessible}" subject="{!Opportunity}" list="OpportunityContactRoles" />
        <apex:relatedList id="closedReferenceReq" rendered="{!$ObjectType.Reference_Request__c.accessible}" subject="{!Opportunity}" list="Reference_Requests__r" />
        <apex:relatedList id="closedOppHistories" subject="{!Opportunity}" list="OpportunityHistories" />
        <apex:relatedList id="closedAttachments" subject="{!Opportunity}" list="CombinedAttachments" />
        <apex:relatedList id="closedTeamMembership" rendered="{!$ObjectType.Team_Membership__c.accessible}" subject="{!Opportunity}" list="Staff_Assignments__r" />
        
        <!-- Script to show related list hover on top of the page -->
        <script type="text/javascript">
            try {
                
                if({!$ObjectType.Opportunity.fields.Parent_Opportunity__c.accessible})
                    sfdcPage.registerRelatedList('pge:closedProgramOppsRList', '', '', false, '', '',false,false,true, '');
                
                if({!$ObjectType.SBQQ__Quote__c.accessible})
                    sfdcPage.registerRelatedList('pge:closedQuoteRList', '', '', false, '', '',false,false,true, '');
                
                if({!$ObjectType.Contract.accessible})
                    sfdcPage.registerRelatedList('pge:closedContractRList', '', '', false, '', '',false,false,true, '');
                    
                if({!$ObjectType.Integrated_Account__c.accessible})
                    sfdcPage.registerRelatedList('pge:closedIntegratedAccountRList', '', '', false, '', '',false,false,true, '');
                
                if({!$ObjectType.SBQQ__Subscription__c.accessible})
                    sfdcPage.registerRelatedList('pge:closedSubscriptionRList', '', '', false, '', '',false,false,true, '');
                    
                if({!$ObjectType.OpportunityTeamMember.accessible})
                    sfdcPage.registerRelatedList('pge:closedOppTeamMemRList', '', '', false, '', '',false,false,true, '');
                
                if({!$ObjectType.OpportunityContactRole.accessible})
                    sfdcPage.registerRelatedList('pge:closedOppContractRoles', '', '', false, '', '',false,false,true, '');
                
                if({!$ObjectType.Reference_Request__c.accessible})
                    sfdcPage.registerRelatedList('pge:closedReferenceReq', '', '', false, '', '',false,false,true, '');
                
                sfdcPage.registerRelatedList('pge:closedOppHistories', '', '', false, '', '',false,false,true, '');
                
                sfdcPage.registerRelatedList('pge:closedAttachments', '', '', false, '', '',false,false,true, '');
                
                if({!$ObjectType.Team_Membership__c.accessible})
                    sfdcPage.registerRelatedList('pge:closedTeamMembership', '', '', false, '', '',false,false,true, '');
                     
            } catch (e) {}
        </script>
    </apex:outputPanel>
</apex:page>